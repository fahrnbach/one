---
title: "GraphQL Schema"
description: "Unified content schema for Blog API using Yoga, D1, and Zod â€” covering both GraphQL and Markdown frontmatter."
tags: ["graphql", "schema", "blog", "cms", "zod", "d1", "fieldmap", "api"]
author: "Jacob Fahrnbach"
ai_used: true
model: "ChatGPT 4o-Turbo"
status: "draft"
created: "2025-06-19"
updated: "2025-06-19"
revision: 1.0
alignment: 9
confidence: 10
---

import { Aside } from '@astrojs/starlight/components';

## Overview

This file defines the shared schema for all blog post data exposed by the GraphQL API (powered by [Yoga](https://the-guild.dev/graphql/yoga-server)) and validated via [Zod](https://zod.dev). The schema also reflects the structure of our D1 SQLite database, ensuring a single source of truth across API, database, and frontend systems.

The fields here drive:
- GraphQL resolvers
- Zod validation in the content upload and mutation layer
- Frontmatter parsing and static typing
- SQL table migrations and indexing
- CMS editing features like preview, search, sort, trending, etc.

<Aside type="note">
This schema is designed to be **modular and extensible**, supporting live previews, contributor analytics, and advanced filtering/tagging across the stack.
</Aside>

## FieldMap (Shared Schema Source)

All values listed below represent a merged schema used for:
- **GraphQL Typing**
- **Zod Validation**
- **SQLite Field Mapping (D1)**
- **Markdown Frontmatter Parsing**

The field definitions are centralized in a `FIELD_MAP` object:

```ts
// fieldMap.ts
export const FIELD_MAP = {
  id:               { type: 'string',          required: false, db: true,  zod: true, primary: true },
  title:            { type: 'string',          required: true,  db: true,  zod: true },
  slug:             { type: 'string',          required: true,  db: true,  zod: true, unique: true },
  slugPrefix:       { type: 'boolean',         required: false, db: false, zod: true },
  description:      { type: 'string',          required: false, db: false, zod: true },
  level:            { type: 'string',          required: false, db: true,  zod: true },
  audience:         { type: 'string',          required: false, db: true,  zod: true },
  created:          { type: 'string',          required: true,  db: true,  zod: true },
  edited:           { type: 'string',          required: false, db: true,  zod: true },
  excerpt:          { type: 'string',          required: true,  db: true,  zod: true },
  summaryPoints:    { type: 'string[]',        required: false, db: true,  zod: true, json: true },
  cover:            { type: 'string',          required: false, db: true,  zod: true },
  images:           { type: 'string[]',        required: false, db: false, zod: true },
  ogImageAlt:       { type: 'string',          required: false, db: true,  zod: true },
  languages:        { type: 'string',          required: false, db: true,  zod: true },
  author:           { type: 'string',          required: false, db: true,  zod: true },
  readingTime:      { type: 'number',          required: false, db: true,  zod: true },
  tags:             { type: 'string[]',        required: false, db: false, zod: true, joinTable: 'post_tags' },
  categories:       { type: 'string[]',        required: false, db: false, zod: true, joinTable: 'post_categories' },
  isSeries:         { type: 'boolean',         required: false, db: false, zod: true },
  series:           { type: 'string',          required: false, db: true,  zod: true },
  series_part:      { type: 'number',          required: false, db: true,  zod: true },
  draft:            { type: 'boolean',         required: false, db: true,  zod: true },
  featured:         { type: 'boolean',         required: false, db: true,  zod: true },
  dirty:            { type: 'boolean',         required: false, db: false, zod: true },
  published:        { type: 'boolean',         required: false, db: true,  zod: true },
  visibility:       { type: 'string',          required: false, db: true,  zod: true },
  status:           { type: 'string',          required: false, db: true,  zod: true },
  scheduled:        { type: 'string',          required: false, db: true,  zod: true },
  layout:           { type: 'string',          required: false, db: true,  zod: true },
  index:            { type: 'boolean',         required: false, db: true,  zod: true },
  comments:         { type: 'boolean',         required: false, db: true,  zod: true },
  redirectFrom:     { type: 'string[]',        required: false, db: true,  zod: true, json: true },
  contributors:     { type: 'string[]',        required: false, db: true,  zod: true, json: true },
  usedAI:           { type: 'boolean',         required: false, db: true,  zod: true },
  originalPrompt:   { type: 'string[]',        required: false, db: true,  zod: true, json: true },
  source:           { type: 'string',          required: false, db: true,  zod: true },
  canonical:        { type: 'string',          required: false, db: true,  zod: true },
  authRequired:     { type: 'boolean',         required: false, db: true,  zod: true },
  content:          { type: 'string',          required: false, db: true,  zod: false },
  metadata:         { type: 'record',          required: false, db: true,  zod: false },
};

## SQL Integration

This schema maps directly into the D1 database. Join tables like post_tags and post_categories are normalized for relational integrity and flexible filtering.

```html
<Aside type="caution">
Many fields use JSON-encoded values in SQLite (e.g., `summaryPoints`, `contributors`). Queries must parse these accordingly.
</Aside>
```

## SQL Schema Snippet (Stub)

```SQL
CREATE TABLE posts (
  id TEXT PRIMARY KEY,
  slug TEXT UNIQUE NOT NULL,
  title TEXT NOT NULL,
  excerpt TEXT NOT NULL,
  created TEXT NOT NULL,
  published BOOLEAN DEFAULT false,
  featured BOOLEAN DEFAULT false,
  draft BOOLEAN DEFAULT false,
  comments BOOLEAN DEFAULT false,
  ...
);
```
<Aside>
Full schema definitions available here:<br />
	ðŸ‘‰ Sql Schema [ `/core/api/sql-schema`](/core/api/sql-schema)<br />
	ðŸ‘‰ Zod Schema [ `core/api/zod-schema`](core/api/zod-schema)
</Aside>

## Frontmatter Conventions

<Aside type="tip">
Each `.mdx` post must include at least `title`, `slug`, `excerpt`, and `created`. Optional metadata like `tags`, `author`, or `series` enable advanced UX patterns on the frontend.
</Aside>

```md
<!-- Prompt: Create a SparkDocs MDX file describing the GraphQL schema, Zod schema, and SQL layout for the blog API -->
<!-- AI Notes: Centralize FIELD_MAP logic, explain normalization, and link out to detailed schema stubs -->
```
